# (XDU-AI)《数据结构与算法》大作业————表达式求值
## 0 题目
**利用中缀表达式变后缀的方法实现表达式求值**

## 1 设计目的与概述
在课上和教材中，我们学到了栈的应用——表达式求值，讲述了后缀表达式求值包含中缀表达式转换为后缀表达式和后缀表达式求值，同时教材中也给出了后缀表达式求值的代码。该程序先进行中缀转后缀，将后缀表达式存储后，再进行后缀表达式求值。但是这两个步骤为什么不能同时进行呢？实际上是可以的，具体流程请看后文。笔者曾在网课上听到过表达式求值，讲述了两个步骤结合的可行性，并进行理论分析（未给出代码）。本程序宏观思路取材于教材和网课，实现程序的具体代码全部为笔者手动输入，各工具函数均为笔者自行设计，输入后进行各项检查工作的思路为笔者自创，具有自主知识产权。
本程序主要功能是模仿计算器，使用者输入个位数字和运算符号+、-、\*、/、和( )，最终得出计算结果。运算式包含三种字符：操作数、运算符（+-\*/）、界限符（左右括号）。程序的操作界面采用中缀表达式的方式输入运算式，因为中缀表达式是人们平时经常使用的，且便于人们的理解。然而，中缀表达式并不适合计算机进行计算，需转换成后缀表达式，再进行有关计算。
本程序主要分为四部分：第一部分，将输入的运算式用顺序表存储起来；第二部分，进行各项检查工作（输入字符合法性检查、括号匹配检查、运算符合法性检查），若检查不通过，则重新输入；第三部分，将存储的运算式转换成后缀表达式；第四部分，对后缀表达式进行计算，得出计算结果。
本程序全部采用顺序存储方式。本程序利用的数据结构有顺序表，主要用来将运算式中每一个数字、运算符和界限符存储为字符类型备用；顺序栈，主要用来进行括号匹配和进行中缀变后缀操作以及后缀表达式的求值。
本程序的特点有以下几个方面：第一，独创的表达式输入检查函数（3个），以保证输入的表达式合法，便于后续函数的正常运行；第二，将中缀表达式转换为后缀表达式函数与后缀表达式求值函数相结合。

## 2 程序介绍
本程序包含17个函数：其中9个是实现顺序表、运算符栈和链栈的基本操作；3个检查函数包括：输入字符合法性检查，括号匹配检查，运算符合法性检查；4个工具函数包括：运算符优先级赋值，数字字符转单精度，输入单精度类型的左右操作数和字符类型的运算符，弹出两个操作数栈顶元素和一个运算符栈顶元素、执行相应运算、运算结果压回操作数栈顶；最后一个核心函数，中缀表达式转换为后缀表达式并计算的函数。
实现顺序表和栈基本操作的函数在这里不赘述了，都是课上内容，本程序只进行了少量修改，以适用于本程序。顺序表和运算符栈的数据类型是字符类型，操作数栈的数据类型是单精度浮点数。

### 2.1 主函数
在主函数中，利用while(1)循环，将输入的运算式存储在顺序表中，然后进行各项检查，如果检查通过则跳出循环；若不通过，则输出“输入有误，请检查后重新输入!”，重新输入运算式并存入，继续进行各项检查，直至检查通过。
定义一个单精度浮点数，用于接收核心函数的返回值，即计算结果，并保留3位小数后输出。

### 2.2 检查函数
#### 2.2.1括号匹配检查函数
该函数利用栈的只可在一端进行插入和删除操作的特点，依次扫描顺序表的每一个data，遇到左括号即入栈（Push）。遇到右括号时先判断栈是否为空，若空则证明括号不匹配，若不空则栈顶元素出栈。当扫描完整个顺序表后，括号匹配的情况应该是栈内不存在任何元素，若栈内还存在剩余的括号，则证明括号不匹配。本函数返回值类型为整型（int）,括号不匹配返回值为0，匹配时返回值为1。

#### 2.2.2 输入字符合法性检查
该函数检查顺序表的每一个数据，若数据出现不是0-9、+、-、\*、/、(、)的字符，则返回0；若扫描完所有的数据后未发现不合法的字符，则返回1；

#### 2.2.3 运算符合法性检查
运算符合法需满足以下几点：1. 表达式开头不得是运算符+-\*/ ；2. 输入的操作数必须为个位数，连续输入两个数字即判定不合法；3. 不得连续输入两个运算符（+-\*/），连续输入两个运算符即判定为不合法；4. 左括号前不得有数字，左括号后不得有运算符；5. 右括号前不得有运算符,右括号后不得有数字；6. 表达式结尾不得是运算符+-\*/ 。

### 2.3 工具函数
#### 2.3.1 运算符优先级赋值
核心函数中有需要判断运算符优先级的步骤。本函数将“+”、“-”赋值为1，并返回；将“\*”、“/”赋值为2，并返回。比较优先级时，即可将运算符的优先级赋值进行大小比较。

#### 2.3.2 数字字符转单精度
当扫描到数字字符时需要压入操作数栈（数据类型为单精度），需要将字符类型转换为单精度。本函数通过将扫描到的数字字符与’0’相见，即是两者的ASCII码值的差，就是该数字字符对应的整型变量。

#### 2.3.3 输入单精度类型的左右操作数和字符类型的运算符，给出计算结果
如题目所示，在这里不再赘述。

#### 2.3.4 弹出两个操作数栈顶元素和一个运算符栈顶元素，执行相应运算，运算结果压回操作数栈顶
连续两次从操作数栈中出栈，先出栈的为右操作数，后出栈的为左操作数；然后运算符栈顶元素出栈，执行2.3.3函数，得出运算结果，压入操作数栈。

### 2.4 核心函数——从中缀表达式到求值
有两种方法可以实现中缀表达式的求值：第一种是先进行中缀表达式转换成后缀表达式，再进行后缀表达式的计算；第二种是中缀表达式转换为后缀表达式和后缀表达式计算同时进行。本程序采用第二种方法，因为第二种方法更为简便。
中缀表达式转换为后缀表达式的方法如下。首先初始化一个用于保存暂时还不能确定运算顺序的运算符，然后从左到右处理各个元素，直至末尾。当遇到操作数时，直接加入后缀表达式；当遇到界限符左括号“(”时直接入栈，遇到右括号“)”时则依次弹出栈内运算符并加入后缀表达式，直到弹出“(”为止。在这里需要注意的是左括号不要加入后缀表达式；当遇到运算符（+-*/）时，依次弹出栈内优先级高于或等于当前运算符（在这里可以利用运算符优先级赋值函数进行比较）的所有运算符，并加入后缀表达式，若遇到左括号“(”或栈空则停止。之后再把当前运算符入栈。在处理完所有字符后，将栈内剩余运算符依次弹出，并加入后缀表达式。
后缀表达式计算方法如下。第一，从左往右扫描下一个元素，直到处理完所有元素；第二，若扫描到操作数则压入栈，并回到第一步，否则执行第三步；若扫描到运算符，则弹出两个栈顶元素，执行相应运算（先出栈的为右操作数，后出栈的为左操作数），运算结果压回栈顶，回到第一步。若表达式合法，则最后栈内只会留下一个元素，就是最终结果。
第二种方法是中缀转后缀表达式和后缀表达式计算的结合，一边生成后缀表达式，一边计算后缀表达式前半部分的值。具体方法如下：首先初始化两个栈，操作数栈和运算法栈；若扫描到操作数，则压入操作数栈；若扫描到运算符或界限符，则按照“中缀转后缀”相同的逻辑压入运算符栈（期间也会弹出运算符，每当弹出一个运算符时，就需要再弹出两个操作数栈的栈顶元素并执行相应运算，运算结果再压回操作数栈）。
